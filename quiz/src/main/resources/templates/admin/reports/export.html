<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin}">
<head>
    <title>Export Data</title>
</head>
<body>
    <div layout:fragment="adminContent">
        <!-- Page Heading -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0 text-gray-800">Export Data</h1>
            <div>
                <button class="btn btn-sm btn-outline-secondary me-2" onclick="window.print()">
                    <i class="bi bi-printer me-1"></i> Print
                </button>
                <a href="#" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#exportModal">
                    <i class="bi bi-plus-circle me-1"></i> New Export
                </a>
            </div>
        </div>

        <!-- Export Options Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-4">
                <div class="card h-100 export-option-card" data-type="quiz_results">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-primary text-white mb-3 mx-auto">
                            <i class="bi bi-clipboard-data fs-4"></i>
                        </div>
                        <h5 class="card-title mb-1">Quiz Results</h5>
                        <p class="text-muted small">Export detailed quiz results and statistics</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card h-100 export-option-card" data-type="user_activity">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-success text-white mb-3 mx-auto">
                            <i class="bi bi-people fs-4"></i>
                        </div>
                        <h5 class="card-title mb-1">User Activity</h5>
                        <p class="text-muted small">Export user login and activity logs</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card h-100 export-option-card" data-type="system_metrics">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-info text-white mb-3 mx-auto">
                            <i class="bi bi-graph-up fs-4"></i>
                        </div>
                        <h5 class="card-title mb-1">System Metrics</h5>
                        <p class="text-muted small">Export system performance metrics</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card h-100 export-option-card" data-type="full_report">
                    <div class="card-body text-center">
                        <div class="icon-circle bg-warning text-white mb-3 mx-auto">
                            <i class="bi bi-file-earmark-text fs-4"></i>
                        </div>
                        <h5 class="card-title mb-1">Full Report</h5>
                        <p class="text-muted small">Complete system report with all data</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Row -->
        <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Export Options</h6>
                </div>
                <div class="card-body">
                    <form id="exportForm" th:action="@{/admin/reports/export/process}" method="POST">
                        <div class="form-group">
                            <label for="exportType">Export Type</label>
                            <select class="form-control" id="exportType" name="exportType" required>
                                <option value="">-- Select Export Type --</option>
                                <option value="quiz_results">Quiz Results</option>
                                <option value="user_activity">User Activity</option>
                                <option value="system_metrics">System Metrics</option>
                                <option value="full_report">Full Report</option>
                            </select>
                        </div>

                        <div class="form-group mt-3">
                            <label for="timeframe">Timeframe</label>
                            <select class="form-control" id="timeframe" name="timeframe" required>
                                <option th:each="option : ${timeframeOptions.entrySet()}" 
                                        th:value="${option.key}" 
                                        th:text="${option.value}">
                                </option>
                            </select>
                        </div>

                        <div class="form-group mt-3">
                            <label for="format">Format</label>
                            <select class="form-control" id="format" name="format" required>
                                <option th:each="format : ${exportFormats}" 
                                        th:value="${format.toLowerCase()}" 
                                        th:text="${format}">
                                </option>
                            </select>
                        </div>

                        <div class="form-group form-check mt-3">
                            <input type="checkbox" class="form-check-input" id="includeCharts" name="includeCharts">
                            <label class="form-check-label" for="includeCharts">Include charts (PDF only)</label>
                        </div>

                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="includeDetails" name="includeDetails" checked>
                            <label class="form-check-label" for="includeDetails">Include detailed data</label>
                        </div>

                        <button type="submit" class="btn btn-primary mt-3">
                            <i class="bi bi-download me-2"></i> Export Data
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Export History</h6>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <div class="text-xs font-weight-bold text-primary text-uppercase">Quiz Results</div>
                                <div class="text-xs text-muted">Nov 13, 2023 10:30 AM</div>
                            </div>
                            <a href="#" class="btn btn-sm btn-outline-primary">Download</a>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <div class="text-xs font-weight-bold text-primary text-uppercase">User Activity</div>
                                <div class="text-xs text-muted">Nov 10, 2023 02:15 PM</div>
                            </div>
                            <a href="#" class="btn btn-sm btn-outline-primary">Download</a>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <div class="text-xs font-weight-bold text-primary text-uppercase">System Metrics</div>
                                <div class="text-xs text-muted">Nov 5, 2023 09:45 AM</div>
                            </div>
                            <a href="#" class="btn btn-sm btn-outline-primary">Download</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        <!-- Export Modal -->
        <div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exportModalLabel">Export Data</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="exportForm" th:action="@{\''}" method="POST">
                        <input type="hidden" name="exportType" id="exportType" value="">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="timeframe" class="form-label">Timeframe</label>
                                        <select class="form-select" id="timeframe" name="timeframe" required>
                                            <option th:each="option : ${timeframeOptions.entrySet()}" 
                                                    th:value="${option.key}" 
                                                    th:text="${option.value}">
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="format" class="form-label">Format</label>
                                        <select class="form-select" id="format" name="format" required>
                                            <option th:each="format : ${exportFormats}" 
                                                    th:value="${format.toLowerCase()}" 
                                                    th:text="${format}">
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeCharts" name="includeCharts">
                                    <label class="form-check-label" for="includeCharts">
                                        Include charts (for PDF/Excel)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeDetails" name="includeDetails" checked>
                                    <label class="form-check-label" for="includeDetails">
                                        Include detailed data
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-download me-1"></i> Export
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script th:inline="javascript">
        // Set active menu item
        document.addEventListener('DOMContentLoaded', function() {
            // Set active menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('a[href$="/admin/reports/export"]')?.parentElement.classList.add('active');
            
            // Handle export option selection
            const exportOptions = document.querySelectorAll('.export-option-card');
            const exportModal = new bootstrap.Modal(document.getElementById('exportModal'));
            const exportTypeInput = document.getElementById('exportType');
            
            exportOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove active class from all options
                    exportOptions.forEach(opt => opt.classList.remove('active'));
                    // Add active class to selected option
                    this.classList.add('active');
                    // Set the export type
                    const exportType = this.getAttribute('data-type');
                    exportTypeInput.value = exportType;
                    // Update modal title
                    document.getElementById('exportModalLabel').textContent = 
                        'Export ' + this.querySelector('.card-title').textContent;
                    // Show the modal
                    exportModal.show();
                });
            });
            
            // Handle form submission
            const exportForm = document.getElementById('exportForm');
            if (exportForm) {
                exportForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Show loading state
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalBtnText = submitBtn.innerHTML;
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Exporting...';
                    
                    // Simulate API call (replace with actual form submission)
                    setTimeout(() => {
                        // Show success message
                        const toast = document.createElement('div');
                        toast.className = 'position-fixed bottom-0 end-0 m-3 p-3 bg-success text-white rounded shadow';
                        toast.style.zIndex = '1100';
                        toast.innerHTML = `
                            <div class="d-flex align-items-center">
                                <i class="bi bi-check-circle me-2"></i>
                                <span>Export completed successfully!</span>
                            </div>
                        `;
                        document.body.appendChild(toast);
                        
                        // Remove toast after 3 seconds
                        setTimeout(() => {
                            toast.style.opacity = '0';
                            setTimeout(() => toast.remove(), 300);
                        }, 3000);
                        
                        // Reset button and close modal
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalBtnText;
                        exportModal.hide();
                        
                        // Here you would typically submit the form
                        // this.submit();
                    }, 1500);
                });
            }
    // Set active menu item
    document.addEventListener('DOMContentLoaded', function() {
        // Set active menu
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector('a[href$="/admin/reports/export"]')?.parentElement.classList.add('active');
        
        // Initialize form validation and handle submission
        const exportForm = document.getElementById('exportForm');
        if (exportForm) {
            exportForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Exporting...';
                
                // Simulate API call (replace with actual form submission)
                setTimeout(() => {
                    // Show success message
                    const toast = document.createElement('div');
                    toast.className = 'position-fixed bottom-0 end-0 m-3 p-3 bg-success text-white rounded shadow';
                    toast.style.zIndex = '1100';
                    toast.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="bi bi-check-circle me-2"></i>
                            <span>Export completed successfully!</span>
                        </div>
                    `;
                    document.body.appendChild(toast);
                    
                    // Remove toast after 3 seconds
                    setTimeout(() => {
                        toast.style.opacity = '0';
                        setTimeout(() => toast.remove(), 300);
                    }, 3000);
                    
                    // Reset button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalBtnText;
                    
                    // Here you would typically submit the form
                    // this.submit();
                }, 2000);
            });
        }
    });
        });
    </script>
</body>
</html>
